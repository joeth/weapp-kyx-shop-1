"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function wxParse(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wxParseData",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"html",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'<div class="color:red;">数据不能为空</div>',r=arguments[3],i=arguments[4],n=r,o={};if("html"==a)o=_html2json2.default.html2json(t,e);else if("md"==a||"markdown"==a){var d=new _showdown2.default.Converter,s=d.makeHtml(t);o=_html2json2.default.html2json(s,e)}o.view={},o.view.imagePadding=0,void 0!==i&&(o.view.imagePadding=i);var l={};return l[e]=o,n.setData(l),n.bindData=l,n.wxParseImgLoad=wxParseImgLoad,n.wxParseImgTap=wxParseImgTap,l.wxParseImgLoad=wxParseImgLoad,l.wxParseImgTap=wxParseImgTap,l}function wxParseImgTap(e,a){var t=e.target.dataset.src,r=e.target.dataset.from;void 0!==r&&r.length>0&&wx.previewImage({current:t,urls:a[r].imageUrls})}function wxParseImgLoad(e){var a=this,t=e.target.dataset.from,r=e.target.dataset.idx;void 0!==t&&t.length>0&&calMoreImageInfo(e,r,a,t)}function calMoreImageInfo(e,a,t,r){var i,n=t.data[r];if(n&&0!=n.images.length){var o=n.images,d=wxAutoImageCal(e.detail.width,e.detail.height,t,r),s=o[a].index,l=""+r,m=!0,g=!1,w=void 0;try{for(var h,u=s.split(".")[Symbol.iterator]();!(m=(h=u.next()).done);m=!0){l+=".nodes["+h.value+"]"}}catch(e){g=!0,w=e}finally{try{!m&&u.return&&u.return()}finally{if(g)throw w}}var f=l+".width",v=l+".height";t.setData((i={},_defineProperty(i,f,d.imageWidth),_defineProperty(i,v,d.imageheight),i))}}function wxAutoImageCal(e,a,t,r){var i=0,n=0,o=0,d={},s=t.data[r].view.imagePadding;return i=realWindowWidth-2*s,realWindowHeight,e>i?(n=i,o=n*a/e,d.imageWidth=n,d.imageheight=o):(d.imageWidth=e,d.imageheight=a),d}function wxParseTemArray(e,a,t,r){for(var i=[],n=r.data,o=null,d=0;d<t;d++){var s=n[a+d].nodes;i.push(s)}e=e||"wxParseTemArray",o=JSON.parse('{"'+e+'":""}'),o[e]=i,r.setData(o)}function emojisInit(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"https://keyixingapi.local.co.bendan.name/applet/emojis/",t=arguments[2];_html2json2.default.emojisInit(e,a,t)}var _showdown=require("./showdown.js"),_showdown2=_interopRequireDefault(_showdown),_html2json=require("./html2json.js"),_html2json2=_interopRequireDefault(_html2json),realWindowWidth=0,realWindowHeight=0;wx.getSystemInfo({success:function(e){realWindowWidth=e.windowWidth,realWindowHeight=e.windowHeight}}),module.exports={wxParse:wxParse,wxParseImgTap:wxParseImgTap,wxParseTemArray:wxParseTemArray,emojisInit:emojisInit};